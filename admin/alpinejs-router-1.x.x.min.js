(()=>{var d=class{#t;constructor(r,e={}){this.#t=new URL(r),this.mode=e.mode??"web",this.base=e.base??""}set url(r){this.#t=new URL(r)}get url(){return this.#t.href}get path(){return this.mode==="hash"&&this.#t.hash?this.#t.hash.slice(1).split("?").shift():this.#t.pathname.replace(this.base,"")}get query(){return Object.fromEntries(new URLSearchParams(this.#t.href.indexOf("?")>-1?this.#t.href.split("?").pop():""))}resolve(r,e,s=!1){let n=this.#t.origin+this.base+(this.mode==="hash"?"#":"")+r,o=s?new URLSearchParams(e).toString():new URLSearchParams({...this.query,...e}).toString();return this.url=n+(o?"?"+o:""),this}};var u=class{static build(r){if(r.indexOf(":")===-1)return r;let e=r.split("/").map(s=>{if(!s.startsWith(":"))return s;let n=s.substr(1),o="[^/]+",b=n.match(/\((.+?)\)/);return b&&(n=n.substr(0,n.indexOf("(")),o=b[1]),`(?<${n}>${o})`}).join("/");return new RegExp(`^${e}$`)}static match(r,e){if(e instanceof RegExp){let s=r.match(e);return s?{...s.groups}:!1}return r===e}static is(r,e){return e instanceof RegExp?e.test(r):r===e}};var _=class{#t={};#e={};add(r){this.#t={...this.#t,[r]:this.#e[r]??u.build(r)}}match(r){console.assert(r instanceof d);let e=r.path;for(let[s,n]of Object.entries(this.#t)){let o=u.match(e,n);if(o)return o===!0?{}:o}return!1}is(r,...e){console.assert(r instanceof d);let s=r.path;for(let n of e){let o=this.#t[n]??this.#e[n]??u.build(n);if(this.#e[n]=o,u.is(s,o))return!0}return!1}not(r,...e){console.assert(r instanceof d);let s=r.path;for(let n of e){let o=this.#t[n]??this.#e[n]??u.build(n);if(this.#e[n]=o,u.is(s,o))return!1}return!0}notfound(r){console.assert(r instanceof d);let e=r.path;return Object.values(this.#t).findIndex(s=>u.is(e,s))===-1}};function I(a){let r=new _,e=a.reactive({mode:"web",base:"",href:location.href,path:"",query:{},params:{},loading:!1}),s={get path(){return e.path},get query(){return e.query},get params(){return e.params||{}},get loading(){return e.loading},config(t={}){t.mode!=="hash"&&t.base&&t.base.endsWith("/")&&(t.base=t.base.slice(0,-1)),e.mode=t.mode??"web",e.base=t.base??""},push(...t){return b(...t)},replace(...t){return R(...t)},resolve(t={}){return n(e.href).resolve(e.path,t).url},is(...t){return r.is(n(e.href),...t)},not(...t){return r.not(n(e.href),...t)},get notfound(){return r.notfound(n(e.href))}};a.$router=s,a.magic("router",()=>s);function n(t){return new d(t,{mode:e.mode,base:e.base})}function o(){let t=n(e.href);e.path=t.path,e.query=t.query,e.params=r.match(t)}a.effect(()=>o()),a.nextTick(()=>{e.mode==="web"&&!e.base&&o()}),window.addEventListener("popstate",()=>e.href=location.href);function b(t,m={}){t.startsWith(location.origin)||(e.mode==="hash"?t=location.origin+(e.base||"/")+"#"+t:t=location.origin+e.base+t),location.href!==t&&(history[m.replace?"replaceState":"pushState"]({},"",t),e.href=t)}function R(t){b(t,{replace:!0})}let w={},g={},L=new Set;a.directive("route",(t,{modifiers:m,expression:f},{effect:E,cleanup:y})=>{m.includes("notfound")||r.add(f);let v=i=>(g[i]?g[i].then(c=>t.innerHTML=c):g[i]=fetch(i).then(c=>c.text()).then(c=>(w[i]=c,t.innerHTML=c,c)),g[i]),h=t.getAttribute("template")??t.getAttribute("template.preload"),p;t.hasAttribute("template.preload")&&(p=v(h).finally(()=>p=!1));function l(){if(t._x_currentIfEl)return t._x_currentIfEl;let i=()=>{if(L.has(f))return;L.add(f);let c=t.content.cloneNode(!0).firstElementChild;a.addScopeToNode(c,{},t),a.mutateDom(()=>{t.after(c),a.initTree(c)}),t._x_currentIfEl=c,t._x_undoIf=()=>{c.remove(),delete t._x_currentIfEl},a.nextTick(()=>L.delete(f))};t.content.firstElementChild?i():h?w[h]?(t.innerHTML=w[h],i()):p?p.then(()=>i()):(e.loading=!0,v(h).then(()=>i()).finally(()=>e.loading=!1)):console.error(`Template for '${f}' is missing`)}function x(){t._x_undoIf&&(t._x_undoIf(),delete t._x_undoIf)}a.nextTick(()=>{E(()=>{let i=n(e.href);(m.includes("notfound")?r.notfound(i):r.is(i,f))?l():x()})}),y(()=>t._x_undoIf&&t._x_undoIf())}),a.directive("link",(t,{modifiers:m,expression:f},{evaluate:E,effect:y,cleanup:v})=>{let h=n(t.href);t.href=h.resolve(h.path,h.query,!0).url;function p(l){l.preventDefault(),b(t.href,{replace:m.includes("replace")})}if(t.addEventListener("click",p),m.includes("activity")){let l=f?E(f):{};l.active??="active",l.exactActive??="exact-active",y(()=>{let[x,i]=[n(t.href),n(e.href)];t.classList.toggle(l.active,i.path.startsWith(x.path)),t.classList.toggle(l.exactActive,x.path===i.path)})}v(()=>{t.removeEventListener("click",p)})})}document.addEventListener("alpine:init",()=>{window.Alpine.plugin(I)});})();
